---
title: "New method estmating R, G and Z from size distribution"
author: "Charles Hinchliffe, Daniel Falster"
output: html_notebook
editor_options: 
  chunk_output_type: console
---



This .rmd contains the new method for estimating recruitment $R$, growth $G$ and mortality $Z$, from a size distribution of larval fishes.

First we generate data based on the the following assumptions:
* $\bar{z}$ is average mortality,
* There is a linear relationship between age and size, such that $s(a) = s_0 + \bar{g}\, a,$ where $\bar{g}$ is average growth rate across the individuals lifetime. 
This implies that $\frac{\delta\, g}{\delta \,s} = 0$, and $a = (s - s_0)/\bar{g}$, leading to a predicted size distribution of 

$$n(s,t) = \frac{R(t)}{g(s_0)} \, \exp\left(- \frac{\bar{z} \, (s - s_0)}{\bar{g}} \right)$$

We then use a combination of

```{r}
library(rstan)
library(tidyverse)

#Data generation and manipulation functions
source("R/simulate_population.R")
source("R/model1.R")

#Plotting functions
source("R/plot_age_dist.R")
source("R/plot_size_dist.R")
```

## Simulating larval fish population 
First generate a population using the simulate_population() function.
```{r}
# Setting parameters for model1
pars <- default_pars("model1")

binwidth_age <- 1
binwidth_size <- 0.1

# Simulate population
data <- simulate_population(pars = pars)
```

## Plotting functions
Check plot against theoretical age distribution
```{r}
plot_age_dist(data, pars, binwidth_age)
```

Check plot against theoretical size distribution
```{r}
plot_size_dist(data, pars, binwidth_size)
```
