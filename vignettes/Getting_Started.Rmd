---
title: "Getting Started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, set up, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  results = "hold"
)

library(sizedist)
```

`sizedist`  is an R interface for Stan and provides functions to simulate and fit size and age-structured populations models to data. In this *Getting Started* vignette, we will cover the simplest model that is implemented in the package. `model1` assumes mortality and growth are constants. See the Theory vignette for more details on the various models in `sizedist`

### Simulating age structureded data

To begin, let's first start by simulating some data of a hypothetical population. We first need to set some **hyper-parameters** that are used to inform the simulation. See the XXX vignette on the definitions for each hyperparameter. `sizedist` has default hyper-parameters that you can access using the `default_pars()` function. Note that these hyper-parameters are organised as a **list** object and will also be used during model fitting. Learn more about [lists](https://www.tutorialspoint.com/r/r_lists.html)
```{r hyperparams}
library(sizedist)

#Calling this function will return a list of hyperparameters
#Tip: Assign this function into an object for later use
pars <- default_pars("model1")

pars
```

We can now use these hyperparameters to simulate some data using the `simulate_population()` function.

```{r simulate}
#Tip: Assign this function to an object so you have access to the data
data <- simulate_population(pars)

data
```

We created two plotting functions to visualise the distribution of size and age of the simulated population 

```{r visualise, fig.align = "center"}
plot_age_dist(data, pars, binwidth = 1)
```

### Creating binned data for and size

In order to estimate a distribution for size/age in our models, we need  to create bins or 'class intervals' for these variables and tally up the number of observations that fall into each of these bins. The `summarise_bin_counts()` function will do the trick!

```{r age counts}
# Compute bins for age 
age_data <- data %>% summarise_bin_counts(bin_var = age, 
                                          bin_width = 0.1)

age_data
```

```{r size counts, include = FALSE}
# Compute bins for size
size_data <- data %>% summarise_bin_counts(bin_var = size, 
                                          bin_width = 0.1)

size_data
```

### Compose data for model fitting

`sizedist` relies on Stan for estimating size/age distribution models. Stan requires our input data to be a specific list format. Conveniently, the `compose_count_data()` function will translate your binned data into a list for you. Each column from your bin data is converted into a list element with the same name. Learn more about [lists](https://www.tutorialspoint.com/r/r_lists.html)

```{r compose}
standata_age <- age_data %>% compose_count_data()

str(standata_age) # Ta da! Your binned data is now a list!
```

### Fitting your first model

`sizedist` has several models you can fit, here we will fit `model1` which assumes that mortality and growth are constant over time. All models can be viewed using this XXX function. A more detailed overview of each of these models are found in the **Theory vignette**. Before we fit our first model, we need to add some hyper-parameters into our data list. Any relevant hyper-parameters such as the name of the model is added automatically using the `add_pars()` function. 

```{r fit}
standata_age_mod1 <- standata_age %>% add_pars(pars = default_pars("model1")) 

str(standata_age_mod1) #Model name is added to the end of the data list
```

### Let's fit the model! 

```{r, results = "hide"}
age_fit <- fit_sizedist(standata_age_mod1)
```

### TBC for visualing fits and getting coefficients and posteriors etc
